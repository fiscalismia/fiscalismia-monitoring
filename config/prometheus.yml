# =============================================================================
# Prometheus Configuration
# Fiscalismia Infrastructure Monitoring
# =============================================================================
# This configuration collects networking logs via nginx-prometheus-exporter
# and HAProxy stats endpoint from all Fiscalismia instances.
# =============================================================================

global:
  scrape_interval: 15s       # How often to scrape targets
  evaluation_interval: 15s   # How often to evaluate rules
  scrape_timeout: 10s        # Timeout for scraping

  # Labels attached to all metrics
  external_labels:
    monitor: 'fiscalismia-monitor'
    environment: 'production'

# Alertmanager configuration (optional, for future alerting setup)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           # - alertmanager:9093

# Rule files for alerting rules
# rule_files:
#   - "/etc/prometheus/rules/*.yml"

# =============================================================================
# Scrape Configurations
# =============================================================================
scrape_configs:

  # -------------------------------------------------------------------------
  # Prometheus Self-Monitoring
  # -------------------------------------------------------------------------
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          instance: 'monitoring'
          service: 'prometheus'

  # -------------------------------------------------------------------------
  # HAProxy Loadbalancer Metrics
  # Production loadbalancer stats endpoint
  # -------------------------------------------------------------------------
  - job_name: 'haproxy-loadbalancer'
    static_configs:
      - targets: ['172.24.1.3:8404']  # HAProxy stats endpoint
        labels:
          instance: 'loadbalancer'
          service: 'haproxy'
          network: 'production'
    metrics_path: /metrics

  # -------------------------------------------------------------------------
  # Production Frontend - Nginx Metrics
  # fiscalismia.com @ 172.24.0.3
  # -------------------------------------------------------------------------
  - job_name: 'nginx-frontend-production'
    static_configs:
      - targets: ['172.24.0.3:9113']  # nginx-prometheus-exporter
        labels:
          instance: 'frontend'
          service: 'nginx'
          domain: 'fiscalismia.com'
          network: 'production'
    metrics_path: /metrics

  # -------------------------------------------------------------------------
  # Production Backend - Nginx Metrics
  # backend.fiscalismia.com @ 172.24.0.4
  # -------------------------------------------------------------------------
  - job_name: 'nginx-backend-production'
    static_configs:
      - targets: ['172.24.0.4:9113']  # nginx-prometheus-exporter
        labels:
          instance: 'backend'
          service: 'nginx'
          domain: 'backend.fiscalismia.com'
          network: 'production'
    metrics_path: /metrics

  # -------------------------------------------------------------------------
  # Demo Instance - Nginx Metrics (Frontend + Backend on same host)
  # demo.fiscalismia.com & backend.demo.fiscalismia.com @ 172.20.0.2
  # -------------------------------------------------------------------------
  - job_name: 'nginx-demo'
    static_configs:
      - targets: ['172.20.0.2:9113']  # nginx-prometheus-exporter for frontend
        labels:
          instance: 'demo-frontend'
          service: 'nginx'
          domain: 'demo.fiscalismia.com'
          network: 'demo'
      - targets: ['172.20.0.2:9114']  # nginx-prometheus-exporter for backend (different port)
        labels:
          instance: 'demo-backend'
          service: 'nginx'
          domain: 'backend.demo.fiscalismia.com'
          network: 'demo'

  # -------------------------------------------------------------------------
  # NAT Gateway - Egress HTTPS Logs
  # NAT Gateway @ 172.24.1.4
  # -------------------------------------------------------------------------
  - job_name: 'nat-gateway-egress'
    static_configs:
      - targets: ['172.24.1.4:9113']  # nginx-prometheus-exporter or custom exporter
        labels:
          instance: 'nat-gateway'
          service: 'egress-proxy'
          network: 'production'
    metrics_path: /metrics

  # -------------------------------------------------------------------------
  # Demo Network - HAProxy or Loadbalancer (if applicable)
  # Demo loadbalancer @ 172.20.1.3
  # -------------------------------------------------------------------------
  - job_name: 'haproxy-demo'
    static_configs:
      - targets: ['172.20.1.3:8404']  # HAProxy stats endpoint
        labels:
          instance: 'loadbalancer-demo'
          service: 'haproxy'
          network: 'demo'
    metrics_path: /metrics
